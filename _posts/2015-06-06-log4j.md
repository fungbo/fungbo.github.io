---
layout: post
title: "Log4j"
date: 2015-06-06 17:50:00
comments: false
---

##Log4j
默认级别:***TRACE < DEBUG < INFO < WARN < ERROR < FATAL***   
*不推荐自定义级别，但是可以*   
*Log4j只打印指定级别以上的log*


**Log4j**有三个主要元素组成：   
*Logger*：影响自己和Children的打印的级别   
*Appender*：指定打在哪   
*Layout*：指定logg的格式
 
**Logger**按*名称*来确定继承关系，比如:   

	Logger x = Logger.getLogger("A");
那么logger x的名称就是A，它的Parent默认是***rootLogger***。   
*Log4j有一个默认**rootLogger**，level是DEBUG, 没有默认的appender*。   
如果A没有自己指定level，那么它的level会默认继承自rootLogger，也就是DEBUG，除非setAdditivity(false)

	Logger y = Logger.getLogger("A.B");
logger y的名称就是A.B，那么它的Parent就是A，Ancestor是rootLogger。如果它自己没有指定level，而A指定的level是INFO，那它的level就是INFO，除非setAdditivity(false)   

**Appender**也会按logger的规则来继承：   
如果指定了rootLogger的appdener是*console*，那么x和y默认都会往*console*中打印。如果x又指定了*file*，那么x就会打印到*console*和*file*各一份，所以如果x又指定了*console*，那么x的log会在*console*中打两份。   

如果x指定setAdditivity(false)，那么在这一层继承关系就中断了，不会再往上继承。   

**Appender**中可以指定*layout*和*filter*，*layout*比较简单，来看*filter*，常用的filter有*LevelMatchFilter*和*LevelRangeFilter*.   

	log4j.xml
	<appender name="a1" class="org.apache.log4j.DailyRollingFileAppender">
	    <param name="File" value="/logstore/a1.log" />
	    <param name="Append" value="true" />
	    <param name="DatePattern" value=""'.'yyyy-MM-dd" />
	    
	    <filter class="org.apache.log4j.varia.LevelRangeFilter">
	         <param name="levelMin" value="debug"/>
	         <param name="levelMax" value="info" />
            <param name="acceptOnMatch" value="true"/>
	    </filter>
	</appender>
	
	<appender name="a2" class="org.apache.log4j.DailyRollingFileAppender">
	    <param name="File" value="/logstore/a2.log" />
	    <param name="Append" value="true" />
	    <param name="DatePattern" value=""'.'yyyy-MM-dd" />
	    
	    <filter class="org.apache.log4j.varia.LevelMatchFilter">
	         <param name="levelToMatch" value="warn"/>
            <param name="acceptOnMatch" value="true"/>
	    </filter>
	    <filter class="org.apache.log4j.varia.DenyAllFilter"/>
	</appender>
	
	<category name="A" additivity="false">
	    <priority value="debug" />
	    <appender-ref ref="a1" />
	    <appender-ref ref="a2" />
	</category>

**category**指定了logger A的level是debug，所以只有debug以上的log才会打出来，A有两个appender。   

**a1**是一个***LevelRangeFilter***类型的*filter*。意思是，如果请求的log level不在debug（包含）和info（包含）之间，那么不会被打印。如果在debug和info之间，如果acceptOnMatch是true，log会被打印。如果acceptionOnMatch是false，会由后续filter来决定。如果没有其他filter，那么log会被打印。例如请求打印warn的log，那么就会被a1的filter给过滤掉，也就是a1.log文件中一定会记录debug和info的log。   

**a2**是一个***LevelMatchFilter***类型的*filter*。意思是，如果请求的log level是warn的话，如果acceptOnMatch是true，一定会被打印，如果acceptOnMatch是false，一定不会打印。如果不是warn，会由后续的filter来决定。例如请求打印error的log，由于不是warn，由后续的filter决定。在filter chain中还有一个***DenyALlFilter***类型的filter，所以一定不会打印，也就是a2.log文件中一定会记录warn的log。

**a1**和**a2**的Appender都是**DailyRollingFileAppender**，还可以指定其他类型:   
**ConsoleAppender**：控制台   
**FileAppender**：文件   
**DailyRollingFileAppender**：每天产生一个日志文件   
**RollingFileAppender**：文件大小到达指定尺寸的时候产生一个新的文件   
**WriterAppender**：将日志信息以流格式发送到任意指定的地方   






